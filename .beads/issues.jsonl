{"id":"karen-0qo","title":"Implement: GitHub Webhook Implementation","description":"Epic: Epic 010: GitHub Webhook Implementation\n\nSpec file: epics/010-github-webhooks/EPIC.md\n\n# Epic 010: GitHub Webhook Implementation\n\n**Priority:** P1 - HIGH  \n**Status:** Draft (Pending Approval)  \n**Estimated Duration:** 2-3 days  \n\n---\n\n## Problem Statement\n\nGitHub webhook handler is a **stub** ‚Äî webhooks are received but not processed. This blocks CI/CD integration and PR comments.\n\n**Location:** `KarenCLI/packages/karen-backend/src/github/github.controller.ts` lines 117-129\n\n**Current (stub):**\n```typescript\n@Post('webhook')\nasync handleWebhook(@Body() payload: any) {\n  // TODO: Verify signature and process webhook\n  return { success: true, message: 'Webhook received (not yet implemented)' };\n}\n```\n\n---\n\n## Scope\n\n### In Scope\n- [ ] Webhook signature verification (HMAC SHA-256)\n- [ ] Handle `push` events ‚Üí trigger audit on default branch\n- [ ] Handle `pull_request` events ‚Üí trigger PR audit\n- [ ] Handle `installation` events ‚Üí app install/removal\n- [ ] Post PR comments with audit results\n- [ ] Update commit status (pending/success/failure)\n\n### Out of Scope\n- GitHub App marketplace listing\n- GitHub Actions integration\n- Check Runs API (using simpler commit status)\n\n---\n\n## Technical Approach\n\n### Signature Verification\n```typescript\nimport * as crypto from 'crypto';\n\nfunction verifySignature(payload: string, signature: string, secret: string): boolean {\n  const expected = 'sha256=' + crypto\n    .createHmac('sha256', secret)\n    .update(payload)\n    .digest('hex');\n  return crypto.timingSafeEqual(Buffer.from(signature), Buffer.from(expected));\n}\n```\n\n### Event Routing\n```typescript\nswitch (event) {\n  case 'push':\n    // Trigger audit if default branch\n    break;\n  case 'pull_request':\n    // Trigger audit, post comment, set status\n    break;\n  case 'installation':\n    // Handle app install/uninstall\n    break;\n}\n```\n\n### PR Comment Format\n```markdown\n## üîç Karen CSS Audit Results\n\n| Severity | Count |\n|----------|-------|\n| üî¥ Error | 3 |\n| üü° Warning | 7 |\n| üîµ Info | 2 |\n\n[View Full Report](https://karen.dev/audits/xxx)\n```\n\n---\n\n## Tasks\n\n| # | Task | Assignee | Status |\n|---|------|----------|--------|\n| 1 | Implement signature verification | TBD | Not Started |\n| 2 | Parse and route webhook events | TBD | Not Started |\n| 3 | Handle push events | TBD | Not Started |\n| 4 | Handle pull_request events | TBD | Not Started |\n| 5 | Handle installation events | TBD | Not Started |\n| 6 | Implement PR comment posting | TBD | Not Started |\n| 7 | Implement commit status updates | TBD | Not Started |\n| 8 | Tests with mock payloads | TBD | Not Started |\n\n---\nAuto-created by backfill script from merged epic.","status":"open","priority":2,"issue_type":"task","owner":"sahar.h.barak@gmail.com","created_at":"2026-02-04T14:13:34.410632+02:00","created_by":"SaharBarak","updated_at":"2026-02-04T14:13:34.410632+02:00"}
{"id":"karen-4c5","title":"Implement: CLI Algorithm Bug Fixes","description":"Epic: Epic 004: CLI Algorithm Bug Fixes\n\nSpec file: epics/004-cli-algorithm-fixes/EPIC.md\n\n# Epic 004: CLI Algorithm Bug Fixes\n\n**Priority:** P0 - HIGH  \n**Status:** Draft (Pending Approval)  \n**Estimated Duration:** 1 day  \n\n---\n\n## Problem Statement\n\nTwo detector algorithms have bugs causing incorrect audit results:\n\n### Bug 1: Color Threshold Too Permissive\n- **Location:** `karen-cli/src/detectors/colors.ts` line 77\n- **Spec says:** deltaE \u003c 5 for near-duplicates\n- **Code says:** deltaE \u003c 15\n- **Impact:** Similar colors not being flagged (3x too permissive)\n\n### Bug 2: Spacing Tolerance Too Strict\n- **Location:** `karen-cli/src/detectors/spacing.ts` line 15\n- **Spec says:** Within 2px = PASS\n- **Code says:** \u003c 1px = PASS\n- **Impact:** False positives - valid spacing flagged as issues\n\n---\n\n## Scope\n\n### In Scope\n- [ ] Fix color deltaE threshold: 15 ‚Üí 5\n- [ ] Fix spacing tolerance: \u003c 1 ‚Üí \u003c= 2\n- [ ] Add regression tests for both fixes\n\n### Out of Scope\n- Other detector improvements\n- Performance optimizations\n\n---\n\n## Technical Approach\n\n### Color Fix (colors.ts line 77)\n```typescript\n// Current (WRONG):\nif (distance \u003e 0 \u0026\u0026 distance \u003c 15)\n\n// Fix:\nif (distance \u003e 0 \u0026\u0026 distance \u003c 5)\n```\n\n### Spacing Fix (spacing.ts line 15)\n```typescript\n// Current (WRONG):\nreturn scale.some((scaleValue) =\u003e Math.abs(value - scaleValue) \u003c 1);\n\n// Fix:\nreturn scale.some((scaleValue) =\u003e Math.abs(value - scaleValue) \u003c= 2);\n```\n\n---\n\n## Tasks\n\n| # | Task | Assignee | Status |\n|---|------|----------|--------|\n| 1 | Fix color deltaE threshold | TBD | Not Started |\n| 2 | Add color threshold regression test | TBD | Not Started |\n| 3 | Fix spacing tolerance calculation | TBD | Not Started |\n| 4 | Add spacing tolerance regression test | TBD | Not Started |\n| 5 | Run full test suite | TBD | Not Started |\n\n---\n\n## Definition of Done\n\n- [ ] Color threshold matches spec (deltaE \u003c 5)\n- [ ] Spacing tolerance matches spec (\u003c= 2px)\n- [ ] Regression tests pass\n- [ ] Full test suite passes\n- [ ] No new issues introduced\n\n---\n\n## Spec Reference\n\n- Colors: `specs/core-detectors.md` line 142\n- Spacing: `specs/core-detectors.md` lines 85-87\n\n---\n\n## Dependencies\n\n**Blocked by:** None  \n**Blocks:** Accurate audit results\n\n---\nAuto-created by backfill script from merged epic.","status":"open","priority":2,"issue_type":"task","owner":"sahar.h.barak@gmail.com","created_at":"2026-02-04T14:13:36.77377+02:00","created_by":"SaharBarak","updated_at":"2026-02-04T14:13:36.77377+02:00"}
{"id":"karen-5wj","title":"Implement: Authentication System","description":"Epic: Epic 001: Authentication System\n\nSpec file: epics/001-auth-system/EPIC.md\n\n# Epic 001: Authentication System\n\n**Priority:** P0 - CRITICAL SECURITY  \n**Status:** Draft (Pending Approval)  \n**Estimated Duration:** 2-3 days  \n\n---\n\n## Problem Statement\n\nThe backend has a **critical security vulnerability**: all protected routes fall back to a hardcoded `test-user-id` when no authentication is provided. This means any unauthenticated request gets access to test user data.\n\n**Location:** `KarenCLI/packages/karen-backend/src/audits/audits.controller.ts`  \n**Lines:** 27, 49, 63  \n**Current vulnerable code:**\n```typescript\nconst userId = req.user?.id || 'test-user-id';\n```\n\n---\n\n## Scope\n\n### In Scope\n- [ ] Create NestJS authentication module with JWT strategy\n- [ ] Remove hardcoded `test-user-id` fallback from all controllers\n- [ ] Implement JWT guard for protected routes\n- [ ] Add login/register endpoints\n- [ ] Proper 401 Unauthorized responses for unauthenticated requests\n\n### Out of Scope\n- OAuth providers (GitHub OAuth is separate epic)\n- Password reset flow\n- Email verification\n\n---\n\n## Technical Approach\n\n### Files to Create\n```\nKarenCLI/packages/karen-backend/src/auth/\n‚îú‚îÄ‚îÄ auth.module.ts           # NestJS module definition\n‚îú‚îÄ‚îÄ auth.controller.ts       # Login/logout/register endpoints\n‚îú‚îÄ‚îÄ auth.service.ts          # Token generation/validation\n‚îú‚îÄ‚îÄ guards/jwt.guard.ts      # Route protection guard\n‚îú‚îÄ‚îÄ strategies/jwt.strategy.ts # Passport JWT strategy\n‚îî‚îÄ‚îÄ dto/\n    ‚îú‚îÄ‚îÄ login.dto.ts         # Login request validation\n    ‚îî‚îÄ‚îÄ register.dto.ts      # Registration validation\n```\n\n### Files to Modify\n- `audits.controller.ts` - Remove test-user-id, add @UseGuards(JwtAuthGuard)\n- `github.controller.ts` - Add guards (except webhook endpoint)\n- `stripe.controller.ts` - Add guards (checkout/portal methods)\n- `app.module.ts` - Import AuthModule\n\n### Environment Variables Required\n```\nJWT_SECRET=\u003cmin 32 characters\u003e\nJWT_EXPIRY=7d\n```\n\n---\n\n## Tasks\n\n| # | Task | Assignee | Status |\n|---|------|----------|--------|\n| 1 | Create auth module skeleton | TBD | Not Started |\n| 2 | Implement JWT strategy with Passport | TBD | Not Started |\n| 3 | Create JwtAuthGuard | TBD | Not Started |\n| 4 | Add login/register endpoints | TBD | Not Started |\n| 5 | Apply guards to audits.controller.ts | TBD | Not Started |\n| 6 | Apply guards to github.controller.ts | TBD | Not Started |\n| 7 | Apply guards to stripe.controller.ts | TBD | Not Started |\n| 8 | Remove all test-user-id fallbacks | TBD | Not Started |\n| 9 | Add unit tests for auth service | TBD | Not Started |\n| 10 | Integration test: unauthorized access returns 401 | TBD | Not Started |\n\n---\n\n## Definition of Done\n\n- [ ] No routes use hardcoded user IDs\n- [ ] All protected routes require valid JWT\n- [ ] Unauthenticated requests return 401 Unauthorized\n- [ ] Unit tests for auth service pass\n- [ ] Integration test confirms auth bypass is fixed\n- [ ] Code review approved\n\n---\n\n## Spec Reference\n\n`specs/backend-api.md` lines 111-173\n\n---\n\n---\nAuto-created by backfill script from merged epic.","status":"open","priority":2,"issue_type":"task","owner":"sahar.h.barak@gmail.com","created_at":"2026-02-04T14:13:37.90125+02:00","created_by":"SaharBarak","updated_at":"2026-02-04T14:13:37.90125+02:00"}
{"id":"karen-6te","title":"Implement: Backend Job Queue System","description":"Epic: Epic 007: Backend Job Queue System\n\nSpec file: epics/007-job-queue-system/EPIC.md\n\n# Epic 007: Backend Job Queue System\n\n**Priority:** P1 - HIGH  \n**Status:** Draft (Pending Approval)  \n**Estimated Duration:** 2-3 days  \n\n---\n\n## Problem Statement\n\nThe backend has **no job queue infrastructure**. Audits run synchronously, blocking requests and causing timeouts. There's no retry logic, progress tracking, or failure handling.\n\nThis is required to properly fix Epic 005 (Audit Job Trigger).\n\n---\n\n## Scope\n\n### In Scope\n- [ ] Set up Bull queue with Redis\n- [ ] Create audit job processor\n- [ ] Implement job retry logic (3 attempts, exponential backoff)\n- [ ] Add job progress events via WebSocket\n- [ ] Dead letter queue for failed jobs\n\n### Out of Scope\n- Notification job queue (future)\n- Scheduled/recurring jobs\n- Multi-region queue distribution\n\n---\n\n## Technical Approach\n\n### Files to Create\n```\nKarenCLI/packages/karen-backend/src/queue/\n‚îú‚îÄ‚îÄ queue.module.ts       # BullModule configuration\n‚îú‚îÄ‚îÄ audit.processor.ts    # Job processing logic\n‚îî‚îÄ‚îÄ audit.producer.ts     # Job creation service\n```\n\n### Files to Modify\n- `src/audits/audits.module.ts` - Import QueueModule\n- `src/app.module.ts` - Register BullModule with Redis\n\n### Queue Configuration\n```typescript\nBullModule.forRoot({\n  redis: process.env.REDIS_URL,\n});\n\nBullModule.registerQueue({\n  name: 'audit-jobs',\n  defaultJobOptions: {\n    attempts: 3,\n    backoff: { type: 'exponential', delay: 1000 },\n    removeOnComplete: 100,\n    removeOnFail: 50,\n  },\n});\n```\n\n### Job Lifecycle\n1. API creates job ‚Üí returns jobId immediately\n2. Processor picks up job ‚Üí updates status to \"processing\"\n3. Progress events sent via WebSocket (0-100%)\n4. Completion ‚Üí status \"completed\" with results\n5. Failure after 3 retries ‚Üí dead letter queue\n\n---\n\n## Tasks\n\n| # | Task | Assignee | Status |\n|---|------|----------|--------|\n| 1 | Add Bull and Redis dependencies | TBD | Not Started |\n| 2 | Create queue.module.ts with config | TBD | Not Started |\n| 3 | Implement audit.processor.ts | TBD | Not Started |\n| 4 | Implement audit.producer.ts | TBD | Not Started |\n| 5 | Add WebSocket progress events | TBD | Not Started |\n| 6 | Implement dead letter queue handling | TBD | Not Started |\n| 7 | Add Redis health check | TBD | Not Started |\n| 8 | Integration tests | TBD | Not Started |\n\n---\n\n## Infrastructure Required\n\n- Redis server (local dev: Docker, prod: managed Redis)\n\n```yaml\n# docker-compose.yml addition\nredis:\n  image: redis:7-alpine\n  ports:\n    - \"6379:6379\"\n```\n\n---\n\n---\nAuto-created by backfill script from merged epic.","status":"open","priority":2,"issue_type":"task","owner":"sahar.h.barak@gmail.com","created_at":"2026-02-04T14:13:35.644807+02:00","created_by":"SaharBarak","updated_at":"2026-02-04T14:13:35.644807+02:00"}
{"id":"karen-8m3","title":"Implement: GitHub Token Security","description":"Epic: Epic 003: GitHub Token Security\n\nSpec file: epics/003-github-security/EPIC.md\n\n# Epic 003: GitHub Token Security\n\n**Priority:** P0 - SECURITY  \n**Status:** Draft (Pending Approval)  \n**Estimated Duration:** 1-2 days  \n\n---\n\n## Problem Statement\n\nGitHub OAuth implementation has multiple security vulnerabilities:\n\n1. **Tokens in query strings** - Logged to server logs, browser history, referrer headers\n2. **Token displayed in HTML** - Partially shown in OAuth success page\n3. **Weak OAuth state** - Uses `Date.now().toString()` which is predictable (CSRF risk)\n\n**Location:** `KarenCLI/packages/karen-backend/src/github/github.controller.ts`\n\n---\n\n## Scope\n\n### In Scope\n- [ ] Move token from query string to Authorization header\n- [ ] Remove token display from HTML response\n- [ ] Fix OAuth state generation with crypto.randomBytes\n- [ ] Implement secure token storage (encrypted in database)\n\n### Out of Scope\n- GitHub App installation flow\n- GitHub webhook implementation (separate epic)\n- Rate limiting for GitHub API\n\n---\n\n## Technical Approach\n\n### Security Fixes\n\n**1. Token from Query String ‚Üí Header (Line 136)**\n```typescript\n// Current (VULNERABLE):\n@Get('repos')\nasync getUserRepos(@Query('access_token') accessToken: string)\n\n// Fix:\n@Get('repos')\nasync getUserRepos(@Headers('authorization') authHeader: string)\n```\n\n**2. OAuth State Generation (Line 24)**\n```typescript\n// Current (VULNERABLE):\nconst state = Date.now().toString();\n\n// Fix:\nconst state = crypto.randomBytes(32).toString('hex');\n```\n\n**3. Token Display (Line 70)**\n- Store token server-side in session/database\n- Return session cookie instead of token in HTML\n\n**4. Encrypted Token Storage**\n- Add encryption key to config\n- Encrypt tokens before database storage\n- Decrypt only when making GitHub API calls\n\n---\n\n## Tasks\n\n| # | Task | Assignee | Status |\n|---|------|----------|--------|\n| 1 | Replace query token with Authorization header | TBD | Not Started |\n| 2 | Fix OAuth state to use crypto.randomBytes | TBD | Not Started |\n| 3 | Remove token from HTML response | TBD | Not Started |\n| 4 | Implement encrypted token storage | TBD | Not Started |\n| 5 | Update frontend to use new auth pattern | TBD | Not Started |\n| 6 | Security audit of OAuth flow | TBD | Not Started |\n\n---\n\n## Definition of Done\n\n- [ ] No tokens in URLs or query strings\n- [ ] OAuth state is cryptographically random\n- [ ] Tokens encrypted at rest in database\n- [ ] Security review passed\n- [ ] No token exposure in logs\n\n---\n\n## Spec Reference\n\n`specs/github-integration.md` lines 40-51\n\n---\n\n## Dependencies\n\n---\nAuto-created by backfill script from merged epic.","status":"open","priority":2,"issue_type":"task","owner":"sahar.h.barak@gmail.com","created_at":"2026-02-04T14:13:37.144174+02:00","created_by":"SaharBarak","updated_at":"2026-02-04T14:13:37.144174+02:00"}
{"id":"karen-bz0","title":"Implement: Subscription Management Page","description":"Epic: Epic 011: Subscription Management Page\n\nSpec file: epics/011-subscription-page/EPIC.md\n\n# Epic 011: Web Subscription Management Page\n\n**Priority:** P1 - HIGH  \n**Status:** Draft (Pending Approval)  \n**Estimated Duration:** 2 days  \n\n---\n\n## Problem Statement\n\nThe user menu links to a subscription page that **returns 404**. Users cannot manage their billing.\n\n**Missing page:** `karen-cli-web/app/dashboard/subscription/page.tsx`\n\n---\n\n## Scope\n\n### In Scope\n- [ ] Create subscription management page\n- [ ] Display current plan and features\n- [ ] Show usage meters (audits used/remaining)\n- [ ] Billing cycle dates\n- [ ] Upgrade/downgrade CTAs\n- [ ] Link to Stripe billing portal\n- [ ] Payment history (last 10 invoices)\n- [ ] Cancel subscription option\n\n### Out of Scope\n- Plan comparison page\n- Proration previews\n- Team seat management\n\n---\n\n## Technical Approach\n\n### File to Create\n`karen-cli-web/app/dashboard/subscription/page.tsx`\n\n### Page Sections\n\n**1. Current Plan**\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ üèÜ Pro Plan                 ‚îÇ\n‚îÇ $29/month                   ‚îÇ\n‚îÇ                             ‚îÇ\n‚îÇ ‚úì 100 audits/month          ‚îÇ\n‚îÇ ‚úì AI recommendations        ‚îÇ\n‚îÇ ‚úì GitHub integration        ‚îÇ\n‚îÇ                             ‚îÇ\n‚îÇ [Upgrade to Team]           ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n**2. Usage Meter**\n```\nAudits this month: 47/100\n‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 47%\nResets: Feb 15, 2026\n```\n\n**3. Billing Actions**\n- \"Manage Payment Methods\" ‚Üí Stripe portal\n- \"View Invoices\" ‚Üí expandable list\n- \"Cancel Subscription\" ‚Üí confirmation modal\n\n### API Endpoints Needed\n- `GET /api/subscriptions/current` - plan details\n- `GET /api/subscriptions/usage` - usage stats (exists)\n- `GET /api/subscriptions/invoices` - payment history\n- `POST /api/subscriptions/portal` - Stripe portal link\n\n---\n\n## Tasks\n\n| # | Task | Assignee | Status |\n|---|------|----------|--------|\n| 1 | Create page layout and routing | TBD | Not Started |\n| 2 | Build current plan display component | TBD | Not Started |\n| 3 | Build usage meter component | TBD | Not Started |\n| 4 | Implement Stripe portal redirect | TBD | Not Started |\n| 5 | Build invoice history component | TBD | Not Started |\n| 6 | Add cancel subscription flow | TBD | Not Started |\n| 7 | Mobile responsive design | TBD | Not Started |\n\n---\n\n## Definition of Done\n\n- [ ] Page accessible from user menu\n- [ ] Current plan displayed correctly\n- [ ] Usage meter accurate\n- [ ] Stripe portal link works\n- [ ] Invoice history loads\n- [ ] Cancel flow with confirmation\n- [ ] Mobile responsive\n\n---\nAuto-created by backfill script from merged epic.","status":"open","priority":2,"issue_type":"task","owner":"sahar.h.barak@gmail.com","created_at":"2026-02-04T14:13:33.913091+02:00","created_by":"SaharBarak","updated_at":"2026-02-04T14:13:33.913091+02:00"}
{"id":"karen-c9c","title":"Implement: Audit Job Trigger","description":"Epic: Epic 005: Audit Job Trigger\n\nSpec file: epics/007-job-queue-system/EPIC.md\n\n# Epic 007: Backend Job Queue System\n\n**Priority:** P1 - HIGH  \n**Status:** Draft (Pending Approval)  \n**Estimated Duration:** 2-3 days  \n\n---\n\n## Problem Statement\n\nThe backend has **no job queue infrastructure**. Audits run synchronously, blocking requests and causing timeouts. There's no retry logic, progress tracking, or failure handling.\n\nThis is required to properly fix Epic 005 (Audit Job Trigger).\n\n---\n\n## Scope\n\n### In Scope\n- [ ] Set up Bull queue with Redis\n- [ ] Create audit job processor\n- [ ] Implement job retry logic (3 attempts, exponential backoff)\n- [ ] Add job progress events via WebSocket\n- [ ] Dead letter queue for failed jobs\n\n### Out of Scope\n- Notification job queue (future)\n- Scheduled/recurring jobs\n- Multi-region queue distribution\n\n---\n\n## Technical Approach\n\n### Files to Create\n```\nKarenCLI/packages/karen-backend/src/queue/\n‚îú‚îÄ‚îÄ queue.module.ts       # BullModule configuration\n‚îú‚îÄ‚îÄ audit.processor.ts    # Job processing logic\n‚îî‚îÄ‚îÄ audit.producer.ts     # Job creation service\n```\n\n### Files to Modify\n- `src/audits/audits.module.ts` - Import QueueModule\n- `src/app.module.ts` - Register BullModule with Redis\n\n### Queue Configuration\n```typescript\nBullModule.forRoot({\n  redis: process.env.REDIS_URL,\n});\n\nBullModule.registerQueue({\n  name: 'audit-jobs',\n  defaultJobOptions: {\n    attempts: 3,\n    backoff: { type: 'exponential', delay: 1000 },\n    removeOnComplete: 100,\n    removeOnFail: 50,\n  },\n});\n```\n\n### Job Lifecycle\n1. API creates job ‚Üí returns jobId immediately\n2. Processor picks up job ‚Üí updates status to \"processing\"\n3. Progress events sent via WebSocket (0-100%)\n4. Completion ‚Üí status \"completed\" with results\n5. Failure after 3 retries ‚Üí dead letter queue\n\n---\n\n## Tasks\n\n| # | Task | Assignee | Status |\n|---|------|----------|--------|\n| 1 | Add Bull and Redis dependencies | TBD | Not Started |\n| 2 | Create queue.module.ts with config | TBD | Not Started |\n| 3 | Implement audit.processor.ts | TBD | Not Started |\n| 4 | Implement audit.producer.ts | TBD | Not Started |\n| 5 | Add WebSocket progress events | TBD | Not Started |\n| 6 | Implement dead letter queue handling | TBD | Not Started |\n| 7 | Add Redis health check | TBD | Not Started |\n| 8 | Integration tests | TBD | Not Started |\n\n---\n\n## Infrastructure Required\n\n- Redis server (local dev: Docker, prod: managed Redis)\n\n```yaml\n# docker-compose.yml addition\nredis:\n  image: redis:7-alpine\n  ports:\n    - \"6379:6379\"\n```\n\n---\n\n---\nAuto-created by backfill script from merged epic.","status":"open","priority":2,"issue_type":"task","owner":"sahar.h.barak@gmail.com","created_at":"2026-02-04T14:13:36.393256+02:00","created_by":"SaharBarak","updated_at":"2026-02-04T14:13:36.393256+02:00"}
{"id":"karen-eg7","title":"Implement: CLI Watch Mode","description":"Epic: Epic 009: CLI Watch Mode\n\nSpec file: epics/009-cli-watch-mode/EPIC.md\n\n# Epic 009: CLI Watch Mode\n\n**Priority:** P1 - HIGH  \n**Status:** Draft (Pending Approval)  \n**Estimated Duration:** 3-4 days  \n\n---\n\n## Problem Statement\n\nThe entire watch mode spec is **not implemented**. Developers cannot get live feedback while editing CSS ‚Äî they must manually re-run audits.\n\n**Spec:** `specs/watch-mode.md` (entire spec unimplemented)\n\n---\n\n## Scope\n\n### In Scope\n- [ ] File watcher with chokidar\n- [ ] Debounced re-auditing (500ms default)\n- [ ] Terminal UI with Ink (React for CLI)\n- [ ] Keyboard shortcuts (q/r/c/o/h)\n- [ ] Browser overlay for visual feedback\n- [ ] `--watch` flag for audit command\n\n### Out of Scope\n- IDE integrations\n- Browser extension\n\n---\n\n## Technical Approach\n\n### Files to Create\n```\nkaren-cli/src/\n‚îú‚îÄ‚îÄ commands/watch.ts       # Watch command\n‚îú‚îÄ‚îÄ watch/\n‚îÇ   ‚îú‚îÄ‚îÄ watcher.ts          # Chokidar file watcher\n‚îÇ   ‚îú‚îÄ‚îÄ ui.tsx              # Ink terminal UI\n‚îÇ   ‚îú‚îÄ‚îÄ overlay-server.ts   # WebSocket server for browser\n‚îÇ   ‚îî‚îÄ‚îÄ keyboard.ts         # Keyboard shortcuts\n```\n\n### File Watcher\n- Use `chokidar` for cross-platform watching\n- Debounce: 500ms (configurable)\n- Incremental analysis (only changed files)\n- Respect `.karenignore` patterns\n\n### Terminal UI (Ink)\n- Current issue count with severity breakdown\n- Last audit timestamp\n- Files being watched\n- Progress indicator during re-audit\n\n### Keyboard Shortcuts\n- `q` - quit watch mode\n- `r` - force full re-audit\n- `c` - clear terminal\n- `o` - open browser overlay\n- `h` - show help\n\n### Browser Overlay\n- WebSocket server on configurable port\n- Inject overlay script into target page\n- Highlight issue locations visually\n\n---\n\n## Tasks\n\n| # | Task | Assignee | Status |\n|---|------|----------|--------|\n| 1 | Create watch command skeleton | TBD | Not Started |\n| 2 | Implement chokidar file watcher | TBD | Not Started |\n| 3 | Add debouncing logic | TBD | Not Started |\n| 4 | Build Ink terminal UI | TBD | Not Started |\n| 5 | Implement keyboard shortcuts | TBD | Not Started |\n| 6 | Create WebSocket overlay server | TBD | Not Started |\n| 7 | Add `--watch` flag to audit command | TBD | Not Started |\n| 8 | Tests | TBD | Not Started |\n\n---\n\n## Definition of Done\n\n- [ ] `karen audit --watch` starts watching\n- [ ] File changes trigger re-audit\n- [ ] Terminal shows live issue updates\n- [ ] Keyboard shortcuts work\n- [ ] Browser overlay highlights issues\n- [ ] Tests pass\n\n---\n\n## Spec Reference\n\n`specs/watch-mode.md` (entire spec)\n\n---\nAuto-created by backfill script from merged epic.","status":"open","priority":2,"issue_type":"task","owner":"sahar.h.barak@gmail.com","created_at":"2026-02-04T14:13:34.841117+02:00","created_by":"SaharBarak","updated_at":"2026-02-04T14:13:34.841117+02:00"}
{"id":"karen-lgv","title":"Implement: Fix Web Dashboard Plan Limits","description":"Epic: Epic 008: Fix Web Dashboard Plan Limits\n\nSpec file: epics/008-web-plan-limits/EPIC.md\n\n# Epic 008: Fix Web Dashboard Plan Limits\n\n**Priority:** P1 - HIGH  \n**Status:** Draft (Pending Approval)  \n**Estimated Duration:** 1 day  \n\n---\n\n## Problem Statement\n\nThe web dashboard has **wrong plan limits** and is missing tier definitions. Users get incorrect quotas.\n\n**Location:** `karen-cli-web/app/api/subscriptions/usage/route.ts` lines 4-8\n\n**Current (WRONG):**\n```typescript\nconst PLAN_LIMITS = {\n  free: 3,        // WRONG - should be 5\n  managed: 1,     // NOT IN SPEC - remove\n  pro: -1,        // WRONG - should be 100\n}\n```\n\n**Spec says (`specs/billing.md` lines 7-12):**\n```typescript\nconst PLAN_LIMITS = {\n  free: 5,        // 5 audits/month\n  pro: 100,       // 100 audits/month\n  team: 500,      // 500 audits/month\n  enterprise: -1, // unlimited\n}\n```\n\n---\n\n## Scope\n\n### In Scope\n- [ ] Fix plan limit values to match spec\n- [ ] Add missing tiers (team, enterprise)\n- [ ] Remove non-spec tier (managed)\n- [ ] Update usage display logic\n\n### Out of Scope\n- Stripe plan creation\n- Plan upgrade/downgrade flow\n\n---\n\n## Technical Approach\n\n### File to Modify\n`karen-cli-web/app/api/subscriptions/usage/route.ts`\n\n### Change Required\n```typescript\n// REPLACE lines 4-8 with:\nconst PLAN_LIMITS: Record\u003cstring, number\u003e = {\n  free: 5,\n  pro: 100,\n  team: 500,\n  enterprise: -1, // unlimited\n};\n```\n\n### Validation\n- [ ] Verify free users see 5 audit limit\n- [ ] Verify pro users see 100 audit limit\n- [ ] Verify team users see 500 audit limit\n- [ ] Verify enterprise users see \"unlimited\"\n\n---\n\n## Tasks\n\n| # | Task | Assignee | Status |\n|---|------|----------|--------|\n| 1 | Update PLAN_LIMITS constant | TBD | Not Started |\n| 2 | Test with each plan type | TBD | Not Started |\n| 3 | Update any UI showing limits | TBD | Not Started |\n\n---\n\n## Definition of Done\n\n- [ ] Plan limits match spec exactly\n- [ ] All 4 tiers defined\n- [ ] No invalid \"managed\" tier\n- [ ] UI displays correct limits per plan\n\n---\n\n## Spec Reference\n\n`specs/billing.md` lines 7-12\n\n---\n\n## Dependencies\n\n---\nAuto-created by backfill script from merged epic.","status":"open","priority":2,"issue_type":"task","owner":"sahar.h.barak@gmail.com","created_at":"2026-02-04T14:13:35.270722+02:00","created_by":"SaharBarak","updated_at":"2026-02-04T14:13:35.270722+02:00"}
{"id":"karen-rzs","title":"Implement: CLI Login Command","description":"Epic: Epic 006: CLI Login Command\n\nSpec file: epics/006-cli-login-command/EPIC.md\n\n# Epic 006: CLI Login Command\n\n**Priority:** P1 - HIGH  \n**Status:** Draft (Pending Approval)  \n**Estimated Duration:** 2-3 days  \n\n---\n\n## Problem Statement\n\nThe CLI has **no authentication commands**. Users cannot log in, which blocks all cloud features: sync, team collaboration, and CI integration.\n\n**Missing commands:**\n- `karen login` - Email/password authentication\n- `karen login --github` - GitHub OAuth device flow\n- `karen logout` - Clear credentials\n- `karen whoami` - Show current user\n\n---\n\n## Scope\n\n### In Scope\n- [ ] Create `karen login` command (email/password)\n- [ ] Create `karen login --github` command (OAuth device flow)\n- [ ] Create `karen logout` command\n- [ ] Create `karen whoami` command\n- [ ] Secure credential storage in `~/.karen/credentials.json`\n\n### Out of Scope\n- Password reset flow\n- Multi-account support\n- SSO/SAML\n\n---\n\n## Technical Approach\n\n### Files to Create\n```\nkaren-cli/src/\n‚îú‚îÄ‚îÄ commands/\n‚îÇ   ‚îú‚îÄ‚îÄ login.ts      # Login command\n‚îÇ   ‚îú‚îÄ‚îÄ logout.ts     # Logout command\n‚îÇ   ‚îî‚îÄ‚îÄ whoami.ts     # Show current user\n‚îî‚îÄ‚îÄ core/\n    ‚îî‚îÄ‚îÄ credentials.ts # Secure credential storage\n```\n\n### Files to Modify\n- `karen-cli/src/cli.ts` - Register new commands\n\n### GitHub OAuth Device Flow\n1. Request device code from GitHub\n2. Display user code and verification URL\n3. Poll for token completion\n4. Store token securely\n\n### Credential Storage\n- Location: `~/.karen/credentials.json`\n- Permissions: `chmod 600`\n- Contents: `{ karenToken, githubToken, expiresAt }`\n\n---\n\n## Tasks\n\n| # | Task | Assignee | Status |\n|---|------|----------|--------|\n| 1 | Create credentials.ts storage module | TBD | Not Started |\n| 2 | Implement `karen login` (email/password) | TBD | Not Started |\n| 3 | Implement GitHub OAuth device flow | TBD | Not Started |\n| 4 | Implement `karen logout` | TBD | Not Started |\n| 5 | Implement `karen whoami` | TBD | Not Started |\n| 6 | Add token refresh logic | TBD | Not Started |\n| 7 | Register commands in cli.ts | TBD | Not Started |\n| 8 | Add tests | TBD | Not Started |\n\n---\n\n## Definition of Done\n\n- [ ] `karen login` authenticates and stores token\n- [ ] `karen login --github` completes OAuth flow\n- [ ] `karen logout` clears all credentials\n- [ ] `karen whoami` shows user info and plan\n- [ ] Credentials file has 600 permissions\n- [ ] Tests pass\n\n---\n\n## Spec Reference\n\n`specs/github-integration.md` lines 12-51\n\n---\n\n## Dependencies\n\n**Blocked by:** Epic 001 (Auth System) - needs backend auth endpoints  \n\n---\nAuto-created by backfill script from merged epic.","status":"open","priority":2,"issue_type":"task","owner":"sahar.h.barak@gmail.com","created_at":"2026-02-04T14:13:36.013719+02:00","created_by":"SaharBarak","updated_at":"2026-02-04T14:13:36.013719+02:00"}
{"id":"karen-ulf","title":"Implement: Stripe Webhook Implementation","description":"Epic: Epic 002: Stripe Webhook Implementation\n\nSpec file: epics/002-stripe-webhooks/EPIC.md\n\n# Epic 002: Stripe Webhook Implementation\n\n**Priority:** P0 - CRITICAL (Broken Billing)  \n**Status:** Draft (Pending Approval)  \n**Estimated Duration:** 1-2 days  \n\n---\n\n## Problem Statement\n\nStripe webhook handlers are **stub implementations**. Payments are received but subscriptions are never activated in the database. Users pay but get no access.\n\n**Location:** `KarenCLI/packages/karen-backend/src/stripe/stripe.service.ts`  \n**Lines:** 79-92  \n**Current broken code:**\n```typescript\nprivate async handleCheckoutCompleted(session: any): Promise\u003cvoid\u003e {\n  // TODO: Update subscription in database\n  console.log('Checkout completed:', session.id);\n}\n```\n\n---\n\n## Scope\n\n### In Scope\n- [ ] Implement `checkout.session.completed` - activate subscription\n- [ ] Implement `customer.subscription.updated` - sync status changes\n- [ ] Implement `customer.subscription.deleted` - handle cancellations\n- [ ] Add `invoice.payment_failed` handler - dunning flow\n- [ ] Add `invoice.paid` handler - reset usage counters\n\n### Out of Scope\n- Stripe checkout page customization\n- Proration handling for plan changes\n- Refund automation\n\n---\n\n## Technical Approach\n\n### Files to Modify\n```\nKarenCLI/packages/karen-backend/src/stripe/\n‚îú‚îÄ‚îÄ stripe.service.ts    # Implement webhook handlers\n‚îî‚îÄ‚îÄ stripe.controller.ts # Verify no changes needed\n```\n\n### Webhook Implementation Details\n\n**checkout.session.completed:**\n- Extract `customer`, `subscription`, `metadata` from session\n- Create/update user subscription in Supabase\n- Set: `stripe_customer_id`, `stripe_subscription_id`, `plan`, `status`\n- Reset usage counters\n\n**customer.subscription.updated:**\n- Update `current_period_start`, `current_period_end`\n- Update `status` and `plan`\n\n**customer.subscription.deleted:**\n- Downgrade to free tier\n- Clear Stripe IDs\n- Send notification (future)\n\n### Environment Variables Required\n```\nSTRIPE_SECRET_KEY=sk_live_xxx\nSTRIPE_WEBHOOK_SECRET=whsec_xxx\n```\n\n---\n\n## Tasks\n\n| # | Task | Assignee | Status |\n|---|------|----------|--------|\n| 1 | Implement checkout.session.completed handler | TBD | Not Started |\n| 2 | Implement subscription.updated handler | TBD | Not Started |\n| 3 | Implement subscription.deleted handler | TBD | Not Started |\n| 4 | Add invoice.payment_failed handler | TBD | Not Started |\n| 5 | Add invoice.paid handler | TBD | Not Started |\n| 6 | Add signature verification tests | TBD | Not Started |\n| 7 | Integration test with Stripe CLI | TBD | Not Started |\n\n---\n\n## Definition of Done\n\n- [ ] Successful checkout creates subscription record\n- [ ] Plan upgrades/downgrades update database\n- [ ] Cancellations downgrade to free tier\n- [ ] Failed payments trigger appropriate status update\n- [ ] All webhook handlers have unit tests\n- [ ] Tested with `stripe trigger` CLI commands\n\n---\n\n## Spec Reference\n\n---\nAuto-created by backfill script from merged epic.","status":"open","priority":2,"issue_type":"task","owner":"sahar.h.barak@gmail.com","created_at":"2026-02-04T14:13:37.519649+02:00","created_by":"SaharBarak","updated_at":"2026-02-04T14:13:37.519649+02:00"}
